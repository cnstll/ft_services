FROM alpine:3.13

ENV PASV_MIN_PORT=21100
ENV PASV_MAX_PORT=21101

RUN apk update \
&& apk add vsftpd openssl

RUN openssl req -x509 -nodes -days 7300 \
            -newkey rsa:2048 -keyout /etc/ssl/private/vsftpd.key \
			-out /etc/ssl/certs/vsftpd.crt \
            -subj "/C=FR/O=ft/CN=iloveftservice" \
&& chmod 600 /etc/ssl/private/vsftpd.key /etc/ssl/certs/vsftpd.crt

RUN mkdir -p /home/vsftpd /etc/vsftpd/vsftpd_user_conf/ /var/run/vsftpd/sec

COPY entrypoint.sh .
COPY vsftpd.conf /etc/vsftpd/vsftpd.conf
COPY vsftpd.userlist /etc/vsftpd/vsftpd.userlist
COPY user /etc/vsftpd/vsftpd_user_conf/user

RUN chmod +x entrypoint.sh

EXPOSE 990 20-22 21100-21101

ENTRYPOINT ["sh","/entrypoint.sh"]
CMD ["usr/sbin/vsftpd", "/etc/vsftpd/vsftpd.conf"]
